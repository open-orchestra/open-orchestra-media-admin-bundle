{% extends 'OpenOrchestraBackofficeBundle:Form:form_div_layout.html.twig' %}

{% block oo_media_choice_widget %}
    {% spaceless %}
        <div class="media-forms orchestra-media-choice">
            {{ block('form_widget') }}
            {% set src = '/img/no-media.png' %}
            {% set nomedia = true %}
            {% if
                value is not null and
                value.id is defined and
                value.format is defined and
                value.id is not empty
            %}
                {% set src = get_media_url(value.id, value.format) %}
                {% set nomedia = false %}
            {% endif %}

            <div class="image" id="preview-{{ form.vars.id }}">
                <img height="100px" src="{{ src }}" alt="{{ value.alt }}" title="{{ value.alt }}" />
                <div
                    class="no-media"
                    {% if (false == nomedia) %}
                        style="display:none"
                    {% endif %}
                >
                    {{ 'open_orchestra_media_admin.form.media.no_media_selected'|trans }}
                </div> 
            </div>
            {% if not disabled %}
                <a class="btn btn-border btn-browse"
                    role="button"
                    data-media-type="{{ form.vars.filter }}"
                    data-form-id="{{ form.vars.id }}"
                >
                    {{ 'open_orchestra_media_admin.left_menu.editorial.browse'|trans({'language':context.currentLocale}) }}
                    {% if form.vars.filter %}
                        <br />[ {{ ('open_orchestra_media_admin.media_filter.' ~ form.vars.filter) |trans({'language':context.currentLocale}) }} ]
                    {% endif %}
                </a>
                <a class="btn btn-border btn-remove"
                    role="button"
                    data-form-id="{{ form.vars.id }}"
                >
                    {{ 'open_orchestra_backoffice.form.remove'|trans }}
                </a>
            {% endif %}
            {{ form_errors(form.children.id) }}
            <div id="{{ id }}_modal"></div>
        </div>
    {% endspaceless %}
{% endblock oo_media_choice_widget %}

{% block _oo_media_image_format_row %}
    {% if form.parent.vars.alternatives is defined %}
        {{ form_row(form) }}
    {% else %}
        <p class="well text-center">
            {{ 'open_orchestra_media_admin.form.media.alternative_loading'|trans }}
        </p>
    {% endif %}
{% endblock _oo_media_image_format_row %}

{% block _oo_media_image_format_widget %}
    {% spaceless %}
        {{ form_widget(form) }}
        <!-- STORED ALTERNATIVE VERSIONS -->
        <div class="media_crop_preview">
            <img class="media_crop_original" src="{{ form.parent.vars.alternatives.original }}"
            {% if ('' != form.vars.value) %}style="display: none;"{% endif %}>
            {% for choice in form.vars.choices %}
                <img class="media_crop_{{ choice.value }}" src="{{ form.parent.vars.alternatives[choice.value] }}"
                {% if (choice.value != form.vars.value) %}style="display: none;"{% endif %}>
            {% endfor %}
        </div>

        <!-- ALTERNATIVE VERSIONS ACTION BUTTONS -->
        <div class="media_format_actions"{% if ('' == form.vars.value) %} style="display:none;"{% endif %}>
            <a href="#" class="btn btn-border btn-crop" id="crop_action_button" role="button">
                {{ 'open_orchestra_media_admin.form.media.manual_crop'|trans }}
            </a>
            <a href="#" class="btn btn-border btn-exchange" id="upload_action_button" role="button">
                {{ 'open_orchestra_media_admin.form.media.alternative_file'|trans }}
            </a>
        </div>

        <!-- CROP TOOL -->
        <div id="crop-group" style="display:none">
            <img src="{{ form.parent.vars.alternatives.original }}" class="superbox-current-img"/><br />
            <div id="preview-pane" style="display: none">
                <div class="preview-container">
                    <img  class="jcrop-preview" alt="Preview" />
                </div>
            </div>
        </div>

        <!-- UPLOAD TOOL -->
        <div class="media-override-format-form" style="display:none"></div>
    {% endspaceless %}
{% endblock _oo_media_image_format_widget %}



{% block bootstrap_collection_widget %}
    {% spaceless %}
        {% set delete_button_text = form.vars.delete_button_text %}
        {% set add_button_text = form.vars.add_button_text %}
        {% if translation_domain is not same as (false) %}
            {% set delete_button_text = delete_button_text|trans({}, translation_domain) %}
            {% set add_button_text = add_button_text|trans({}, translation_domain) %}
        {% endif %}
        {% if prototype is defined %}
            {% set prototype_vars = {} %}
            {% if style is defined %}
                {% set prototype_vars = prototype_vars|merge({'style': style}) %}
            {% endif %}
            {% set prototype_html = '<div class="col-xs-' ~ form.vars.sub_widget_col ~ '">' ~ form_widget(prototype, prototype_vars) ~ '</div>' %}
            {% if form.vars.allow_delete %}
                {% set prototype_html = prototype_html ~ '<div class="col-xs-' ~ form.vars.button_col ~ '"><a href="#" class="' ~ form.vars.delete_button_class ~ '" data-removefield="collection" data-field="__id__"><i class="fa fa-trash"></i></a></div>' %}
            {% endif %}
            {% set prototype_html = '<div class="row">' ~ prototype_html ~ '</div>' %}

            {% set attr = attr|merge({'data-prototype': prototype_html }) %}
            {% set attr = attr|merge({'data-prototype-name': prototype_name }) %}
        {% endif %}
        <div {{ block('widget_container_attributes') }}>
            <ul class="bc-collection list-unstyled">
                {% for field in form %}
                    <li>
                        <div class="row">
                            <div class="col-xs-{{ form.vars.sub_widget_col }}">
                                {{ form_widget(field) }}
                                {{ form_errors(field) }}
                            </div>
                            {% if form.vars.allow_delete %}
                                <div class="col-xs-{{ form.vars.button_col }}">
                                    <a href="#" class="{{ form.vars.delete_button_class }}" data-removefield="collection" data-field="{{ field.vars.id }}">{{ delete_button_text|parse_icons|raw }}</a>
                                </div>
                            {% endif %}
                        </div>
                    </li>
                {% endfor %}
            </ul>
            {% if form.vars.allow_add %}
                <a href="#" class="btn btn-border glyphicon glyphicon-plus" data-addfield="collection" data-collection="{{ form.vars.id }}" data-prototype-name="{{ prototype_name }}">{{ add_button_text|parse_icons|raw }}</a>
            {% endif %}
        </div>
    {% endspaceless %}
{% endblock bootstrap_collection_widget %}